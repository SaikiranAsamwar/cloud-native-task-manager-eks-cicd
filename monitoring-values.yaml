# ================================================================
# MONITORING VALUES - Prometheus + Grafana Setup
# Install with Helm:
# helm install prometheus prometheus-community/kube-prometheus-stack \
#   -n monitoring --create-namespace --values monitoring-values.yaml
# ================================================================

prometheus:
  prometheusSpec:
    retention: 30d
    retentionSize: "10GB"
    resources:
      requests:
        memory: "512Mi"
        cpu: "500m"
      limits:
        memory: "1Gi"
        cpu: "1000m"
    
    # Service Monitor for backend
    serviceMonitorSelector:
      matchLabels:
        prometheus: enabled
    
    # Scrape configurations
    additionalScrapeConfigs:
      - job_name: 'backend-api'
        static_configs:
          - targets: ['backend-service.task-manager.svc.cluster.local:5000']
        metrics_path: '/metrics'
      
      - job_name: 'kubernetes-pods'
        kubernetes_sd_configs:
          - role: pod
            namespaces:
              names:
                - task-manager

grafana:
  adminUser: admin
  adminPassword: "GrafanaAdmin@2024"
  
  # Persistence for dashboards
  persistence:
    enabled: true
    type: pvc
    size: 10Gi
    accessModes:
      - ReadWriteOnce
  
  # Data sources
  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
        - name: Prometheus
          type: prometheus
          url: http://prometheus-operated:9090
          access: proxy
          isDefault: true
          editable: true
  
  # Dashboards
  dashboardProviders:
    dashboardproviders.yaml:
      apiVersion: 1
      providers:
        - name: 'default'
          orgId: 1
          folder: ''
          type: file
          disableDeletion: false
          editable: true
          options:
            path: /var/lib/grafana/dashboards/default

alertmanager:
  enabled: true
  
  config:
    global:
      resolve_timeout: 5m
      slack_api_url: "" # Add your Slack webhook URL
    
    route:
      group_by: ['alertname', 'cluster', 'service']
      group_wait: 10s
      group_interval: 10s
      repeat_interval: 12h
      receiver: 'slack-notifications'
      routes:
        - match:
            severity: critical
          receiver: 'slack-notifications'
        - match:
            severity: warning
          receiver: 'slack-notifications'
    
    receivers:
      - name: 'slack-notifications'
        slack_configs:
          - channel: '#alerts'
            title: 'Alert: {{ .GroupLabels.alertname }}'
            text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'

prometheus-node-exporter:
  enabled: true

kube-state-metrics:
  enabled: true

prometheus-pushgateway:
  enabled: false
